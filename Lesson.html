<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¯Ø±ÙˆØ³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'raaya-green': '#10b981', 
                        'raaya-sky': '#0ea5e9', 
                        'raaya-babyblue': '#38bdf8', 
                        'raaya-beige': '#f5f5dc',
                        'raaya-dark': '#1e293b', 
                        'raaya-light': '#ffffff',
                    },
                }
            }
        }
    </script>
    <link rel="stylesheet" href="css/style.css"> 
</head>
<body class="bg-raaya-beige text-gray-800 transition-colors duration-300 dark:bg-raaya-dark dark:text-raaya-light">

    <header class="bg-raaya-light dark:bg-gray-900 shadow-md transition-colors duration-300">
        <div class="container mx-auto p-4 flex justify-between items-center max-w-7xl">
            <a href="index.html" class="text-2xl font-bold text-raaya-dark dark:text-raaya-light">Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø±Ø¤ÙŠØ©</a>
            <div id="dark-mode-toggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 cursor-pointer">
                <span id="sun-icon" class="text-yellow-500 text-xl">â˜€ï¸</span>
                <span id="moon-icon" class="text-indigo-400 text-xl hidden">ğŸŒ™</span>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8 max-w-4xl mt-10">
        
        <a href="level1.html" class="inline-flex items-center text-raaya-sky hover:text-raaya-dark mb-6 transition duration-300">
            <svg class="w-5 h-5 ml-2 transform rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
            Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„
        </a>

        <h1 class="text-4xl font-extrabold text-raaya-dark dark:text-raaya-light mb-8" id="subject-title">Ø¯Ø±ÙˆØ³ Ø§Ù„Ù…Ø§Ø¯Ø©</h1>
        
        <div id="lessons-list" class="space-y-4">
            </div>

    </main>
    
    <script type="module">
        // ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… type="module" Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…Ù† progress_logic.js
        import { SUBJECT_DATA, isLessonCompleted, isLessonOpen } from './js/progress_logic.js'; 
        import './js/main.js'; // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø§Ù…

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const subjectKey = urlParams.get('subject');

            if (!subjectKey || !SUBJECT_DATA[subjectKey]) {
                document.getElementById('subject-title').textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø§Ø¯Ø©';
                return;
            }
            
            const subjectData = SUBJECT_DATA[subjectKey];
            document.getElementById('subject-title').textContent = `Ù…Ø§Ø¯Ø©: ${subjectData.title}`;
            
            const lessonsList = document.getElementById('lessons-list');

            subjectData.lessons.forEach((lessonId, index) => {
                const lessonNumber = index + 1;
                const lessonTitle = `${lessonNumber}. Ø¯Ø±Ø³ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… ${lessonNumber}`; // Ø¹Ù†ÙˆØ§Ù† Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¯Ø±Ø³
                const isCompleted = isLessonCompleted(subjectKey, lessonId);
                const isOpen = isLessonOpen(subjectKey, index); // index Ù‡Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¯Ø±Ø³ -1

                const completionIcon = isCompleted ? 'âœ…' : (isOpen ? 'â–¶ï¸' : 'ğŸ”’');
                const completionStatus = isCompleted ? 'Ù…ÙƒØªÙ…Ù„' : (isOpen ? 'Ù…ØªØ§Ø­' : 'Ù…ØºÙ„Ù‚');
                
                let linkHref = isOpen ? `lesson_viewer.html?subject=${subjectKey}&lesson=${lessonId}` : '#';
                let cardClass = isOpen ? 
                    'cursor-pointer hover:shadow-xl border-raaya-sky' : 
                    'opacity-60 cursor-not-allowed border-gray-400';
                
                if (isCompleted) {
                    cardClass += ' bg-raaya-green/20';
                }

                const lessonCard = document.createElement('a');
                lessonCard.href = linkHref;
                lessonCard.className = `block bg-raaya-light dark:bg-gray-800 p-5 rounded-xl shadow-lg transition duration-300 flex justify-between items-center border-r-4 ${cardClass}`;
                
                if (!isOpen) {
                    lessonCard.onclick = (e) => {
                        e.preventDefault();
                        alert('ğŸ”’ Ù‡Ø°Ø§ Ø§Ù„Ø¯Ø±Ø³ Ù…ØºÙ„Ù‚ Ø­ØªÙ‰ ØªÙƒÙ…Ù„ Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„Ø³Ø§Ø¨Ù‚.');
                    };
                }

                lessonCard.innerHTML = `
                    <div>
                        <h2 class="text-xl font-bold text-raaya-dark dark:text-raaya-light">${lessonTitle}</h2>
                        <p class="text-gray-600 dark:text-gray-400 mt-1">${completionStatus}</p>
                    </div>
                    <div class="status-indicator font-bold text-3xl">
                        ${completionIcon}
                    </div>
                `;
                lessonsList.appendChild(lessonCard);
            });
        });
    </script>
</body>
</html>